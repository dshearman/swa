% Twitter and Facebook APIs 
% 300958 Social Web Analysis 
% Week 4 Lab

`r opts_chunk$set(prompt=TRUE, comment=NA)`
`r knit_hooks$set(source = function(x, options) paste("<pre lang='r'>", x, "</pre>", sep = ""))`

# R Basics

## Installing R

All of the lab sessions for 300958 Social Web Analysis will use R and
RStudio. If these two applications are not installed on the computer
you are using, download them from:

- R: [http://cran.csiro.au/](http://cran.csiro.au/)
- RStudio: [http://www.rstudio.com/ide/download/desktop](http://www.rstudio.com/ide/download/desktop)

Install R, then Rstudio.

Once they are installed, open RStudio and say hello.
```{r}
print("Hello world!")
```

## Getting familiar with RStudio

Once RStudio is loaded, we will see four sections:

- Text editor (top left). Use this to enter code and save it as a script.
- Console (bottom left). Code can be entered straight into the console, or scripts can be run by entering source("script_filename.r")
- Workspace (top right). This section shows the variables that are currently defined. 
- Browser (bottom right). We can access files, view plots, examine packages and access help in the browser.

To write your first script, type:
```{r}
print("Hello world!")
```
into the text editor, save it as hello.r. Then go to the console section and type:
```{r}
source("hello.r")
```
By sourcing the script, you will run every command. Since there is one command in the script, only one command will be run.

If R complains that it cannot find the file, it may be looking in the wrong directory. To set the directory, use:
```{r}
setwd("directory")
```
where directory is where your script is stored.


# Coding in R

Code in R can be written in a procedural style or object oriented
style. If a script is run, it is interpreted from the top of the file to the bottom.
The control of the flow can be obtained by writing conditional statements (if, else)
and loops (for, while).

## if statement

If the execution of code depends on the state of a variable, we can
use an if statement. For example, if the operating system is Windows,
the file path is "C:\User\greg\file.txt", else the file path is
"/home/greg/file.txt".

The if statement in R has the syntax:
```{.r}
if (condition) {
   ## run this code if condition is true
}
```
The statement can also be extended to include other conditions and a default condition.
```{.r}
if (condition 1) {
   ## run this code if condition 1 is true
}
else if (condition 2) {
   ## run this code if condition 1 is false and condition 2 is true
}
else {
   ## run this code if condition 1  and condition 2 are false
}
```

## Exercise






## for loop

Loops allow us to execute a piece of code a number of times, where the
number of not known until run time. For example, for every year that
Greg has been born, give him a birthday punch.


```{.r}
for (variable in sequence) {
  ### run this code using variable
}
```


## Exercise

The function cat will print its contents to the screen. E.g.
```{r}
a = 5
cat("This is a number ", a, "\n")
```
Write a for loop to convert a number to a sequence of plus signs. For
example, 5 will be converted to "+++++".



## Writing functions

If a particular piece of code is run often, it may be wise to place it
in a function. In R, functions are stored in variables. If we define the function:
```{r}
addOne = function(x) {
       return(x + 1)
}
```
we can examine the function by typing its name in the console and pressing enter.
To run the function, we must add parentheses to the end and include any arguments:
```{r}
addOne(5)
```
If the result is not assigned to a variable, it is printed to the screen.


## Installing Libraries

Installing libraries requires access to the Internet and hence R needs
to know about the Web proxy when within UWS.

Information on how to tell R about the proxy is here:

- http://support.rstudio.org/help/kb/faq/configuring-r-to-use-an-http-proxy

Information about the proxy setting is here:

- http://www.uws.edu.au/information_technology_services/its/servicedesk/proxy_settings

Once this has been done, you may install libraries using the install.packages command:

install.packages("twitteR")

If R will not speak to the proxy, you can download the packages and install them locally.

Get the package from here:

- http://cran.r-project.org/web/packages/available_packages_by_name.html

Install the package by telling R where you saved it:

- install.packages("/tmp/bigdata_0.1.tgz", repos=NULL)


# Accessing Twitter

To access the Twitter API, a Twitter account is needed. If you do not have one, sign up here:

- https://twitter.com/

To access the Twitter API, we must register a program that is accessing the API. To register the program, visit this link:

- https://dev.twitter.com/apps

and log in. Once you have logged in, click "Create a new application"
and fill in the form. When the application is created, it will be
provided a consumer key and a consumer secret; these text sequences
are needed soon.

We can access the Twitter API in R by loading the twitteR and ROAuth libraries (and
installing them first if needed).

`r library("twitteR")`
```{r}
library("twitteR")
library("ROAuth")
```

We then need to set up the OAuth session details. Note: insert your
applications key and secret where needed.

```{.r}
cred <- OAuthFactory$new(consumerKey="insert here",
     consumerSecret="insert here",
     requestURL="https://api.twitter.com/oauth/request_token",
     accessURL="https://api.twitter.com/oauth/access_token",
     authURL="https://api.twitter.com/oauth/authorize")
cred$handshake()
```

Once the handshake is performed, R will ask you to visit a URL to get
an access code from Twitter. Get this code and provide it to R.
Once the handshake is done, we can save the credential information
and use it later, without having go directly to Twitter again.

```{.r}
save(cred, file="twitter.Rdata")
```

When we want to access Twitter in another session, we simply load and
register the credentials:
```{.r}
load("twitter.Rdata")
registerTwitterOAuth(cred)
```


```{.r}
x = searchTwitter('kevin bacon')

x = searchTwitter('social web analytics', n = 500, lang = "en")
z = twListToDF(x)



library("wordcloud")
library("tm")

cz = Corpus(VectorSource(z$text))
#cz = tm_map(cz, function(x) iconv(enc2utf8(x), sub = "byte"))
cz = tm_map(cz, function(x) iconv(x, to='UTF-8-MAC', sub='byte'))
cz <- tm_map(cz, removeNumbers)
cz <- tm_map(cz, removePunctuation)
cz <- tm_map(cz, stripWhitespace)
cz <- tm_map(cz, tolower)
cz <- tm_map(cz, removeWords, stopwords("english")) # this stopword file is at C:\Users\[username]\Documents\R\win-library\2.13\tm\stopwords 
cz <- tm_map(cz, removeWords, c("social", "web", "analytics"))
cz <- tm_map(cz, function(x) sub("http[^ ]*","", x))
cz <- tm_map(cz, stemDocument, language = "english")
wordcloud(cz)


library(tm) #load text mining library
setwd('F:/My Documents/My texts') #sets R's working directory to near where my files are
a  <-Corpus(DirSource("/My Documents/My texts"), readerControl = list(language="lat")) #specifies the exact folder where my text file(s) is for analysis with tm.
summary(a)  #check what went in
a <- tm_map(a, removeNumbers)
a <- tm_map(a, removePunctuation)
a <- tm_map(a , stripWhitespace)
a <- tm_map(a, tolower)
a <- tm_map(a, removeWords, stopwords("english")) # this stopword file is at C:\Users\[username]\Documents\R\win-library\2.13\tm\stopwords 
a <- tm_map(a, stemDocument, language = "english")
adtm <-DocumentTermMatrix(a) 
adtm <- removeSparseTerms(adtm, 0.75)


cz = Corpus(VectorSource(z$text))
tdm <- TermDocumentMatrix(cz, control = list(removePunctuation = TRUE, stopwords = TRUE, stem = TRUE))
tdm = weightTfIdf(tdm)
inspect(tdm)
tdm2 <- removeSparseTerms(tdm, sparse=0.95)
df <- as.data.frame(inspect(tdm2))
d = dist(df)
h = hclust(d)
rect.hclust(h, k=5, border="red")


cos.dissim <- function(x,y) {
	   x = as.numeric(x)
	   y = as.numeric(y)
	   return(1 - (x %*% y)/(sqrt(x %*% x)*sqrt(y %*% y)))
}

cos.sim <- function(x,y) {
	   x = as.numeric(x)
	   y = as.numeric(y)
	   return((x %*% y)/(sqrt(x %*% x)*sqrt(y %*% y)))
}

d = matrix(0, nrow(df), nrow(df))

for (a in 1:nrow(df)) {
    for (b in 1:nrow(df)) {
    	d[a,b] <- cos.dissim(df[a,],df[b,])
    }
}
rownames(d) <- rownames(df)

d = as.dist(d)
h = hclust(d)
plot(h)

```

http://files.meetup.com/1772780/Mining%20Twitter%20Using%20R.pdf

# Accessing Facebook




# The Game of Life

John Conway developed the Game of Life to show how complex systems can
be obtained from a few simple rules.

[http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life](http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life)

The game has a grid of cells that are either alive or dead. At each
iteration of the game, the state of a cell is determined by the number
of neighbour cells that are alive. The rules are:

- If a cell has three living neighbours, it remains or becomes alive.
- If a cell has two living neighbours, it's state does not change.
- If a cell has less than 2 or more than three living neighbours, it dies.

The game is a zero player game, meaning that once we set up the
initial state are press go, we no longer interact with the game.

There are many initial states that end up with no life after a number
of iterations, but there are many interesting initial states that
grow, cycle or remain static. See the Wikipedia page for details of
these initial states.

We have written the code to run the game of life in R. To run it, simply
source the R script:
```{.r}
source("life.r")
```

Then click on the plot to show where you want the initial life to be,
then click Finish (at the top right corner of the plot). We then watch
the life grow and die.

Unfortunately, the script is missing the code from the function:
```{.r}
count.neighbours <- function(grid, pos) {
  ## Count the number of living neighbours of a point.
  
  counter = 0
  x = pos$x
  y = pos$y
  
  ### insert the missing code here!

  return(counter)
}
```
The function takes the life grid and a position. It returns the number
of living neighbours of the position. Note that each cell has eight
neighbours, so the number returned must be between 0 and 8.

Use your knowledge of R from the previous part of this lab to write
the missing code, then enjoy the game of life.
Make sure to try out some of these staring patterns:
[http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life#Examples_of_patterns](http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life#Examples_of_patterns)


